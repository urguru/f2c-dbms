CREATE TABLE `consumer` (
`idConsumer` int(11) NOT NULL,
`FirstName` varchar(20) NOT NULL,
`LastName` varchar(20) NOT NULL,
`EmailId` varchar(30) NOT NULL,
`MobileNo` varchar(10) NOT NULL,
`Password_Hash` varchar(255) NOT NULL,
`City` varchar(20) NOT NULL,
`VerifiedEmail` tinyint(4) NOT NULL DEFAULT '0',
PRIMARY KEY (`idConsumer`),
UNIQUE KEY `EmailId_UNIQUE` (`EmailId`),
UNIQUE KEY `MobileNo_UNIQUE` (`MobileNo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci


CREATE TABLE `farmer` (
`idFarmer` int(11) NOT NULL,
`FirstName` varchar(20) NOT NULL,
`LastName` varchar(20) NOT NULL,
`EmailId` varchar(30) NOT NULL,
`MobileNo` varchar(10) NOT NULL,
`Password_Hash` varchar(255) NOT NULL,
`City` varchar(20) NOT NULL,
`VerifiedEmail` tinyint(4) NOT NULL DEFAULT '0',
PRIMARY KEY (`idFarmer`),
UNIQUE KEY `EmailId_UNIQUE` (`EmailId`),
UNIQUE KEY `MobileNo_UNIQUE` (`MobileNo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci



CREATE DEFINER = CURRENT_USER TRIGGER `f2c`.`acc_req_AFTER_INSERT` AFTER INSERT ON `acc_req` FOR EACH ROW
BEGIN
    DELETE FROM f_bid 
    WHERE NEW.bid_id!=f_bid.bid_id AND 
    r_id IN (select r_id FROM f_bid WHERE r_id!=(select r_id from f_bid where  NEW.bid_id=f_bid.bid_id));
END


CREATE DEFINER = CURRENT_USER TRIGGER `f2c`.`chats_AFTER_INSERT` AFTER INSERT ON `chats` FOR EACH ROW
BEGIN
    DECLARE CNT INT;
    DECLARE TEMP INT;
    CALL count_notification_bid_id(NEW.bid_id,CNT);
    IF (CNT=2)
    THEN
        SET TEMP=1;
    ELSEIF(CNT=1)
    THEN
        IF ((SELECT f_or_c FROM chats c,notfications n where c.msg_id=n.msg_id limit 1)=(NEW.f_or_c))
        THEN
            SET TEMP=1;
        ELSE
            INSERT INTO notfications(bid_id,msg_id,date) VALUES(new.bid_id,new.msg_id,CURRENT_DATE());
        END IF;
    ELSE
        INSERT INTO notfications(bid_id,msg_id,date) VALUES(new.bid_id,new.msg_id,CURRENT_DATE());
    END IF;
END;
